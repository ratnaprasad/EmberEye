================================================================================
                    EMBEREYE EEPROM CALIBRATION FIX
                          Quick Reference Guide
================================================================================

WHAT WAS FIXED:
- Added hourly EEPROM1 command scheduling (every 3600 seconds)
- Enhanced calibration offset extraction and logging
- Added timestamp tracking for calibration data freshness

WHY IT MATTERS:
- Negative temperature values (-0.69Â°C to -1.27Â°C) = Wrong offset
- Device keeps calibration offset in EEPROM[0]
- Periodic refresh ensures offset matches device calibration

EXPECTED BEHAVIOR ON WINDOWS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Startup (t=0):                                                  â”‚
â”‚   1. EmberEye starts                                            â”‚
â”‚   2. PERIOD_ON sent automatically                              â”‚
â”‚   3. Thermal data starts streaming                             â”‚
â”‚                                                                 â”‚
â”‚ After 1 Hour (t=3600s):                                         â”‚
â”‚   1. Console: "ğŸ”§ Sending EEPROM1 to device..."               â”‚
â”‚   2. Device responds with calibration data                     â”‚
â”‚   3. Console: "âœ… EEPROM1 DATA LOADED: Offset: X.XXÂ°C"        â”‚
â”‚   4. New offset applied to all temperature calculations        â”‚
â”‚                                                                 â”‚
â”‚ Every Hour After:                                              â”‚
â”‚   - EEPROM1 command sent automatically                         â”‚
â”‚   - Offset verified and logged                                 â”‚
â”‚   - Temperature accuracy maintained                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY LOG MESSAGES TO LOOK FOR:

ğŸ“Š EEPROM CALIBRATION APPLIED:
   â”œâ”€ Raw hex word[0]: 0xFFB0
   â”œâ”€ Raw signed value: -80 (centi-degrees)
   â”œâ”€ Offset: -0.80Â°C
   â”œâ”€ Previous offset: 0.00Â°C
   â””â”€ Temperature correction: raw_value Ã· 100 - (-0.80)Â°C

âœ… EEPROM1 DATA LOADED:
   â”œâ”€ Frame ID: 1234
   â”œâ”€ Total size: 3328 chars (832 blocks)
   â”œâ”€ Calibration offset: -0.80Â°C
   â””â”€ Status: Ready for temperature conversion

âœ… EEPROM1 CALIBRATION RECEIVED:
   â”œâ”€ Device: 192.168.1.100
   â”œâ”€ Frame ID: 1234
   â”œâ”€ Blocks: 832
   â”œâ”€ Offset: -0.80Â°C
   â”œâ”€ Timestamp: 2025-12-04 15:47:32
   â””â”€ Next update: In ~1 hour

TEMPERATURE CALCULATION FORMULA:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Temperature (Â°C) = (Raw_Value / 100) - EEPROM_Offset

EXAMPLE 1: Negative offset (common case)
  Raw Value: FFB0 = -80 (centi-degrees)
  EEPROM Offset: -0.80Â°C
  Result: (-80 / 100) - (-0.80) = -0.80 + 0.80 = 0.00Â°C

EXAMPLE 2: Positive offset (recalibrated device)
  Raw Value: FFB0 = -80 (centi-degrees)
  EEPROM Offset: +5.00Â°C
  Result: (-80 / 100) - (5.00) = -0.80 - 5.00 = -5.80Â°C

TROUBLESHOOTING:

Q: Temperatures still showing negative after EEPROM1?
A: Check the offset value printed in logs:
   - If offset = -30Â°C and room is 28Â°C: raw_value would need to be 5800
   - If you see 3000 (30Â°C raw) - 30 = 0Â°C âœ“ CORRECT
   - If offset is way off (+80Â°C): Device calibration may be wrong

Q: No "EEPROM1 DATA LOADED" message after 1 hour?
A: 1. Check if device is still connected (check "PERIOD_ON" messages)
   2. Verify TCP port 4888 (or configured port) is accessible
   3. Check if device supports EEPROM1 command
   4. Restart device and try manual refresh

Q: Offset changed between updates?
A: This is normal! Indicates:
   - Device temperature fluctuations (normal behavior)
   - Sensor recalibration happening internally
   - Environmental temperature changes

FILES MODIFIED:
1. pfds_manager.py       - Hourly EEPROM1 scheduling
2. thermal_frame_parser.py - Enhanced offset logging  
3. main_window.py        - Timestamp tracking

No configuration changes needed - it works automatically!

================================================================================
